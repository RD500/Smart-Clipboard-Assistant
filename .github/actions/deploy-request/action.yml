---
name: 'Deploy Request'
description: 'Request deployment of the IMA and all AddOns'
inputs:
  sha:
    description: 'Commit SHA to deploy'
    default: 'HEAD'
  refname:
    description: 'Branch name to release'
    default: '${{ github.ref_name }}'
  deploy_mode:
    description: 'What to deploy'
    required: true
runs:
  using: "composite"
  steps:
    - uses: bazel-contrib/setup-bazel@0.15.0
      with:
        bazelisk-cache: true
        disk-cache: ${{ github.workflow }}
        repository-cache: true
    - name: Request IME Deployment
      run: |
        bazel run //js/github_deployments -- deploy \
          --api-username=${{ secrets.BOT_MASTER_RW_GITHUB_USERNAME }} \
          --token=${{ secrets.BOT_MASTER_RW_GITHUB_TOKEN }} \
          --owner=${{ github.repository_owner }} \
          --repo=AnySoftKeyboard \
          --sha="${{ inputs.sha }}" \
          --refname="${{ inputs.refname }}" \
          --shardName=ime \
          --deployMode="${{ inputs.deploy_mode }}"
    - name: Request add-ons Deployment
      run: |
        bazel run //js/github_deployments -- deploy \
          --api-username=${{ secrets.BOT_MASTER_RW_GITHUB_USERNAME }} \
          --token=${{ secrets.BOT_MASTER_RW_GITHUB_TOKEN }} \
          --owner=${{ github.repository_owner }} \
          --repo=AnySoftKeyboard \
          --sha="${{ inputs.sha }}" \
          --refname="${{ inputs.refname }}" \
          --shardName=addons \
          --deployMode="${{ inputs.deploy_mode }}"
